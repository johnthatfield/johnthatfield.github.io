<!DOCTYPE html>
<html>

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width">
<link rel="icon" href=/fav.png type="image/gif">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      media="print" onload="this.media='all'" />
<noscript>
  <link
          href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
          rel="stylesheet">
</noscript>


<link rel="stylesheet" href="/css/font.css" media="all">



<meta property="og:title" content="Cell Monitoring Unit (CMU)" />
<meta property="og:description" content="Introduction Cell Monitoring Unit
Talks to slave cell monitoring units (CMUs) over IsoSPI Filters and monitors reported cell voltages and tempeatures Runs cell balancing algorithm Interface to charger to put BMU in charge state and take commands from charger about when to pre-charge Has shutdown interface for Insulation Monitoring Device (IMD), precharge resistor thermal sensor (PDOC), connector interlocks, and BMU battery state. Detection for these interfaces. Joint project with Thomas Hulbert." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.org/projects/cmu/" /><meta property="article:section" content="projects" />
<meta property="article:published_time" content="2023-12-17T16:56:51+01:00" />
<meta property="article:modified_time" content="2023-12-17T16:56:51+01:00" /><meta property="og:site_name" content="Hugo Profile" />


<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Cell Monitoring Unit (CMU)"/>
<meta name="twitter:description" content="Introduction Cell Monitoring Unit
Talks to slave cell monitoring units (CMUs) over IsoSPI Filters and monitors reported cell voltages and tempeatures Runs cell balancing algorithm Interface to charger to put BMU in charge state and take commands from charger about when to pre-charge Has shutdown interface for Insulation Monitoring Device (IMD), precharge resistor thermal sensor (PDOC), connector interlocks, and BMU battery state. Detection for these interfaces. Joint project with Thomas Hulbert."/>


<link rel="stylesheet" href="/bootstrap-5/css/bootstrap.min.css" media="all"><link rel="stylesheet" href="/css/header.css" media="all">
<link rel="stylesheet" href="/css/footer.css" media="all">


<link rel="stylesheet" href="/css/theme.css" media="all">




<style>
    :root {
        --text-color: #343a40;
        --text-secondary-color: #6c757d;
        --background-color: #eaedf0;
        --secondary-background-color: #64ffda1a;
        --primary-color: #007bff;
        --secondary-color: #f8f9fa;

         
        --text-color-dark: #e4e6eb;
        --text-secondary-color-dark: #b0b3b8;
        --background-color-dark: #18191a;
        --secondary-background-color-dark: #212529;
        --primary-color-dark: #ffffff;
        --secondary-color-dark: #212529;
    }
    body {
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        text-align: left;
    }

    html {
        background-color: var(--background-color) !important;
    }

    body::-webkit-scrollbar {
        width: .5em;
        height: .5em;
        background-color: var(--background-color);
    }
    
    ::-webkit-scrollbar-track {
        box-shadow: inset 0 0 6px var(--background-color);
        border-radius: 1rem;
    }
    
    ::-webkit-scrollbar-thumb {
        border-radius: 1rem;
        background-color: var(--secondary-color);
        outline: 1px solid var(--background-color);
    }

    #search-content::-webkit-scrollbar {
        width: .5em;
        height: .1em;
        background-color: var(--background-color);
    }
</style>

<meta name="description" content="">
<link rel="stylesheet" href="/css/single.css">


<script defer src="/fontawesome-6/all-6.4.2.js"></script>

  <title>
Cell Monitoring Unit (CMU) | John Hatfield Portfolio

  </title>
</head>

<body class="light">
  
  
<script>
    let localStorageValue = localStorage.getItem("pref-theme");
    let mediaQuery = window.matchMedia('(prefers-color-scheme: dark)').matches;

    switch (localStorageValue) {
        case "dark":
            document.body.classList.add('dark');
            break;
        case "light":
            document.body.classList.remove('dark');
            break;
        default:
            if (mediaQuery) {
                document.body.classList.add('dark');
            }
            break;
    }
</script>




<script>
    var prevScrollPos = window.pageYOffset;
    window.addEventListener("scroll", function showHeaderOnScroll() {
        let profileHeaderElem = document.getElementById("profileHeader");
        let currentScrollPos = window.pageYOffset;
        let resetHeaderStyle = false;
        let showNavBarOnScrollUp =  true ;
        let showNavBar = showNavBarOnScrollUp ? prevScrollPos > currentScrollPos : currentScrollPos > 0;
        if (showNavBar) {
            profileHeaderElem.classList.add("showHeaderOnTop");
        } else {
            resetHeaderStyle = true;
        }
        if(currentScrollPos === 0) {
            resetHeaderStyle = true;
        }
        if(resetHeaderStyle) {
            profileHeaderElem.classList.remove("showHeaderOnTop");
        }
        prevScrollPos = currentScrollPos;        
    });
</script>



<header id="profileHeader">
    <nav class="pt-3 navbar navbar-expand-lg animate">
        <div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5">
            
            <a class="navbar-brand primary-font text-wrap" href="/">
                
                John Hatfield
                
            </a>

            

            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true">
                    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path>
                </svg>
            </button>

            
            <div class="collapse navbar-collapse text-wrap primary-font" id="navbarContent">
                <ul class="navbar-nav ms-auto text-center">
                    

                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#experience"
                            aria-label="experience">
                            Experience
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#education"
                            aria-label="education">
                            Education
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#projects"
                            aria-label="projects">
                            Projects
                        </a>
                    </li>
                    

                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#contact"
                            aria-label="contact">
                            Contact
                        </a>
                    </li>
                    

                    
                    

                    
                    <li class="nav-item navbar-text">
                        
                        <div class="text-center">
                            <button id="theme-toggle">
                                <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </button>
                        </div>
                    </li>
                    

                </ul>

            </div>
        </div>
    </nav>
</header>
<div id="content">
<section id="single">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-sm-12 col-md-12 col-lg-10 offset-lg-1">
        <div class="pr-lg-4">
          <div class="title mb-5">
            <h1 class="text-center mb-4">Cell Monitoring Unit (CMU)</h1>
            <div class="text-center">
               
              <small>|</small>
              Dec 17, 2023

              
              <span id="readingTime">
                min read
              </span>
              
            </div>
          </div>
          
          <article class="page-content  p-2">
          <h1 id="introduction">Introduction</h1>
<p>Cell Monitoring Unit</p>
<ul>
<li>Talks to slave cell monitoring units (CMUs) over IsoSPI</li>
<li>Filters and monitors reported cell voltages and tempeatures</li>
<li>Runs cell balancing algorithm</li>
<li>Interface to charger to put BMU in charge state and take commands from charger about when to pre-charge</li>
<li>Has shutdown interface for Insulation Monitoring Device (IMD), precharge resistor thermal sensor (PDOC), connector interlocks, and BMU battery state. Detection for these interfaces.</li>
</ul>
<p>Joint project with Thomas Hulbert.</p>
<h1 id="design-requirements">Design Requirements</h1>
<h2 id="fsae-rules-2023">FSAE Rules 2023</h2>
<h3 id="cmu-ams-rules">CMU (AMS) Rules</h3>
<p>At QUT Motorsport we refer to the &lsquo;Accumulator Management System&rsquo; as a combination of the BMU (battery monitoring unit) and CMU (cell monitoring units)</p>
<p>The relevant rules from below are</p>
<ul>
<li>The AMS system must have galvanic isolation at every segment to segment boundary - i.e. isolation transformers</li>
<li>Work in progress</li>
</ul>
<div style="text-align: center;">
<img src="/images/bmu/Rules_AMS.png" alt="AMS FSAE Ruleset 2023" style="max-width: 800px;"/>
</div>
<!-- ### Voltage Separation
- The GLV and the Tractive circuits must be galvanically isolated 

<div style="text-align: center;">
<img src="/images/tsal/FSAERuleVoltageSeparation.png" alt="Voltage Separation FSAE Ruleset 2023" style="max-width: 800px;"/>
</div> -->
<!-- ### PCB Clearance
- 12.7mm clearance over uncoated surface, or 4mm clearance under conformal coating
<div style="text-align: center;">
<img src="/images/tsal/GLVTSClearance.png" alt="Clearance FSAE Ruleset 2023" style="max-width: 800px;"/>
</div> -->
<h2 id="ipc-design-requirements-for-ts-to-ts-clearances">IPC Design Requirements for TS to TS clearances</h2>
<p>On surface of uncoated PCB</p>
<ul>
<li>0.6mm spacing between nets &gt;=31V potential to each other</li>
<li>0.1mm spacing for nets &lt;= 30V potential to each other</li>
</ul>
<h2 id="team-design-requirements">Team Design Requirements</h2>
<h1 id="revision-b---qev-3-only">Revision B - QEV-3 Only</h1>
<p>A long time solution of a &lsquo;Revision A&rsquo; BMU strategy, using a BMU chip, a microcontroller and canbus between each slave device was used. We had some systemic issues with this which caused the upgrade.</p>
<p>The revision A of the CMU was designed to interface in the same position as the previous generation QEV-3 BMS system. It would feature only 10 out of 14 cells.</p>
<p>Assembly of this device is shown below. The pototypes were hand placed at uni and soldered in a vapour phase oven.
<img src="/images/cmu/cmu_rev_b_placed.jpg" alt="CMU Rev B Assembly" title="CMU Rev B Assembly"></p>
<!-- 
Testing of the Revision B CMUs. Two CMUs, one connected to a battery, one connected to a battery emulator board, 

![CMU Rev B Testing](/images/cmu/cmu_rev_b_testing.jpg "CMU Rev B Testing") -->
<p>An implementation error with unused voltage taps was found - a fix was prototyped on the PCB as shown in the photo below.
<img src="/images/cmu/cmu_rev_b.jpg" alt="CMU Rev B" title="CMU Rev B"></p>
<h1 id="revision-c">Revision C</h1>
<p>It was decided that the same CMU architecture should be used for the new vehicle - QEV-4. All 14 cells are required for QEV-4, so a 14 cell CMU should be designed and un-used cells tied together as per the datasheet.</p>
<p>Below shown is the full implementation of the L9963E cell monitoring unit. It was designed around a small, double sided component load form factor, enabling it to fit atop of the small QEV-4 battery assembly.</p>
<p>A board to board connector was chosne, enabling it to either sit atop of a carrier PCB, or, connected with a custom flat flex cable.</p>
<div style="text-align: center;">
<img src="/images/cmu/CMU_Altium.png" alt="CMU Altium" style="max-width: 800px;"/>
</div>
<h2 id="prototype-assembly">Prototype Assembly</h2>
<p>Prototypes were assembled by hand and reflowed in a vapour phase oven.</p>
<div style="text-align: center;">
<img src="/images/cmu/cmu_rev_c_hand_assembly_camera2.jpg" alt="CMU Altium" style="max-width: 800px;"/>
</div>
<h2 id="prototype-testing">Prototype testing</h2>
<p>The initial prototypes were then thoroughly tested using a breakout board to validate cell voltage readings and temperature analog inputs.</p>
<div style="text-align: center;">
<img src="/images/cmu/CMU_rev_c_test_assembly.png" alt="CMU Rev C Test Assembly" style="max-width: 600px;"/>
</div>
<h2 id="qev-3-adaptor">QEV-3 Adaptor</h2>
<p>The adaptor for the previous generation car shown below connects the 10 cells, tying the remaining 4 cells together. It also has a temperature multiplexer to enable the CMU to read more tempearture cells for the larger battery assembly.</p>
<div style="text-align: center;">
<img src="/images/cmu/cmu_qev3_carrier.jpg" alt="CMU Carrier QEV-3" style="max-width: 800px;"/>
</div>
<h2 id="pick-and-place-assembly">Pick and place assembly</h2>
<p>We then worked with our pick and place sponsor, Taylormade Electronics, to pick and place enough CMU&rsquo;s for QEV-3, QEV-4 and several spares. Working with Cameron from Taylormade Electronics has been an invaluable experience. It has enabled my understanding of the full design and assembly lifecycle, seeing first hand impacts of design decisions and changes on ease of assembly and reliability.</p>
<h3 id="solder-paste-application">Solder Paste Application</h3>
<div style="text-align: center;">
<img src="/images/cmu/cmu_paste.jpg" alt="CMU Solder Paste Application" style="max-width: 600px;"/>
</div>
<h3 id="pick-and-place-setup">Pick and Place Setup</h3>
<div style="text-align: center;">
<img src="/images/cmu/cmu_pick_place_setup.jpg" alt="CMU Pick and Place Setup" />
</div>
<h3 id="assembled-cmus">Assembled CMUs</h3>
<div style="text-align: center;">
<img src="/images/cmu/cmu_assembled.jpg" alt="CMU Assembled" style="max-width: 600px;"/>
</div>
<h1 id="schematics">Schematics</h1>
<p>Not published. Please contact me for more information.</p>

          </article>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-3">
        <div id="stickySideBar" class="sticky-sidebar">
          

          

          
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12 col-lg-9 p-4">
        
      </div>
    </div>
  </div>
  <button class="p-2 px-3" onclick="topFunction()" id="topScroll">
    <i class="fas fa-angle-up"></i>
  </button>
</section>


<div class="progress">
  <div id="scroll-progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<Script src="/js/scrollProgressBar.js"></script>


<script>
  var topScroll = document.getElementById("topScroll");
  window.onscroll = function() {scrollFunction()};

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      topScroll.style.display = "block";
    } else {
      topScroll.style.display = "none";
    }
  }

  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }

  
  let stickySideBarElem = document.getElementById("stickySideBar");
  let stickyNavBar =  true ;
  if(stickyNavBar) {
    let headerElem = document.getElementById("profileHeader");
    let headerHeight = headerElem.offsetHeight + 15;
    stickySideBarElem.style.top = headerHeight + "px";
  } else {
    stickySideBarElem.style.top = "50px";
  }
</script>


<script src="/js/readingTime.js"></script>



  </div><footer>
    
 

<div class="text-center pt-2">
    
    <span class="px-1">
        <a href="https://github.com/johnthatfield/" aria-label="github">
            <svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792">
                <path
                    d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5t-203.5 84.5h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-86-13.5q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5h-224q-119 0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5 84.5t84.5 203.5z" />

                <metadata>
                    <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                        xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:dc="http://purl.org/dc/elements/1.1/">
                        <rdf:Description about="https://iconscout.com/legal#licenses"
                            dc:title="Github, Online, Project, Hosting, Square"
                            dc:description="Github, Online, Project, Hosting, Square" dc:publisher="Iconscout"
                            dc:date="2016-12-14" dc:format="image/svg+xml" dc:language="en">
                            <dc:creator>
                                <rdf:Bag>
                                    <rdf:li>Font Awesome</rdf:li>
                                </rdf:Bag>
                            </dc:creator>
                        </rdf:Description>
                    </rdf:RDF>
                </metadata>
            </svg>
        </a>
    </span>
    

    
    <span class="px-1">
        <a href="https://www.linkedin.com/in/jhatfield2/" aria-label="linkedin">
            <svg xmlns="http://www.w3.org/2000/svg" width='2.4em' height='2.4em' fill="#fff" aria-label="LinkedIn"
                viewBox="0 0 512 512">
                <rect width="512" height="512" fill="#0077b5" rx="15%" />
                <circle cx="142" cy="138" r="37" />
                <path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198" />
                <path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32" />
            </svg>
        </a>
    </span>
    

    

    
    <span class="px-1">
        <a href="https://johnhatfield.substack.com/" aria-label="substack" class=>
            <svg role="img" width="34" height="40" viewBox="0 0 16 18" fill="#ff6719" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg" class="frontend-reader2-Nav-module__logo--wRSQX"><g><title></title><path d="M16 4H0V6H16V4Z"></path><path d="M0 8V18L7.9993 13.534L16 18V8H0Z"></path><path d="M16 0H0V2H16V0Z"></path></g></svg>
        </a>
    </span>
    

    

    

    
</div><div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-4 text-center">
            
            &copy; 2023  All rights reserved
            <div class="text-secondary">
                Made with
                <a href="https://github.com/gurusabarish/hugo-profile" target="_blank"
                    title="Designed and developed by gurusabarish">
                    Hugo Profile Theme
                </a>
            </div>
        </div>
    </div>
</div></footer><script src="/bootstrap-5/js/bootstrap.bundle.min.js"></script>
<script>
    if (document.body.className.includes("dark")) {
        document.body.classList.remove('dark');
        localStorage.setItem("pref-theme", 'light');
    }
</script>


<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

</script>












  <section id="search-content" class="py-2">
    <div class="container" id="search-results"></div>
  </section>
</body>

</html>